# 座標計算技術仕様

## 概要
このアプリケーションでは、GPS位置情報と駅座標間の距離計算にヒュベニの公式を採用しています。

## 採用技術

### 1. 距離計算手法
- **ヒュベニの公式** (Hubeny's Formula)
- 楕円体上の2点間距離を高精度計算
- 日本国内での測量標準手法

### 2. 測地系・楕円体
- **GRS80楕円体** (Geodetic Reference System 1980)
- 日本測地系2000（JGD2000）の基準楕円体
- 国際測地学協会が定めた世界標準

## GRS80楕円体パラメータ

```javascript
const a = 6378137.0;        // 長半径（赤道半径）[m]
const b = 6356752.314140;   // 短半径（極半径）[m]
const e2 = (a * a - b * b) / (a * a);  // 第一離心率の二乗
```

## 計算精度

### 距離計算手法の比較
| 手法 | 精度 | 適用範囲 |
|------|------|----------|
| ハーバーサイン公式 | 数百m〜数km誤差 | 球面近似 |
| ヒュベニの公式 | 数cm〜数m誤差 | 楕円体計算 |

### GPS取得精度
- **屋外・晴天時:** 3-5m
- **屋内・建物内:** 10-50m
- **山間部・都市部:** 5-15m

## 位置情報取得設定

```javascript
const options = {
    enableHighAccuracy: true,    // 高精度モード有効
    timeout: 10000,              // 10秒タイムアウト
    maximumAge: 300000           // 5分間キャッシュ
};
```

## 誤差要因

### 主要誤差源
1. **GPS端末側の取得誤差** (主要因)
   - 衛星配置・電波強度
   - 建物・地形による電波遮蔽
   - 大気圏・電離層の影響
   - 端末のGPSチップ性能

2. **計算誤差** (最小限)
   - ヒュベニの公式: 数cm〜数m程度
   - 駅座標データ: 固定値で安定

## 実装箇所

- **距離計算:** `script.js:154-184`
- **位置情報取得:** `script.js:62-66`
- **精度表示:** `script.js:118`

## 技術的根拠

ヒュベニの公式は地球の実際の形状（楕円体）を考慮するため、球面近似による計算よりも高精度です。特に日本国内の短距離計算（数十km程度）では非常に正確な結果が得られます。

---
*作成日: 2025-07-07*